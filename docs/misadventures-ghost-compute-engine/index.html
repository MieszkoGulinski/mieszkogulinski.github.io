<!doctype html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><title>(Mis)adventures when installing Ghost CMS on Google Compute Engine</title><style>body,html{margin:0 0}body{color:#222;font-size:18px;line-height:1.5}.header-content,article,footer{margin:0 auto;padding:0 15px;max-width:710px}h1{border-bottom:2px solid #ffd744;padding-bottom:15px;font-size:32px}.blog-name{text-align:center;padding-bottom:25px}h2{font-size:24px}h3{font-size:20px}a{text-decoration:none;color:#927200;transition:color .25s ease-out}a:hover{color:#bb9200}code{font-size:14px}pre{overflow:auto}img{max-width:100%}.footer-content{margin-top:15px;border-top:2px solid #ffd744;padding-top:15px;padding-bottom:15px}.art-list-link{font-size:22px;margin-bottom:5px}.art-list-link a{color:#222;transition:color .2s ease-out}.art-list-link a:hover{color:#555}.art-list-date{font-size:16px}@media (prefers-color-scheme:dark){body{background:#222;color:#fff}a{color:#ffd744}a:hover{color:#bb9200}.art-list-link a{color:#fff}.art-list-link a:hover{color:#eee}}@media (min-width:768px){body{font-size:20px}code{font-size:16px}}</style><link href="/img/favicon.svg" rel="icon" type="image/svg+xml"><link href="/img/favicon.ico" rel="alternate icon"></head><body><article><h1>(Mis)adventures when installing Ghost CMS on Google Compute Engine</h1><h1>Installing Ghost</h1><p>At work, I was installing <a href="https://ghost.org/">Ghost CMS</a> on Google Compute Engine. Simply following <a href="https://ghost.org/docs/install/ubuntu/">the instructions</a> wasn't 100% enough. Here are the some of the things that needed to be adjusted. I hope it'll be helpful in troubleshooting of other installations :)</p><ul><li>Ghost version is 5.45.1, installed through Ghost CLI.</li><li>Operating system is Ubuntu 22.04</li><li>Node.js version is 16.20.0 (as Node 16 is recommended in Ghost documentation).</li><li>Compute Engine instance type is <a href="https://cloud.google.com/compute/docs/general-purpose-machines#e2-shared-core">e2-micro</a>, with 10 GB of <a href="https://cloud.google.com/compute/docs/disks#pdspecs">Balanced type</a> storage.</li></ul><h2>Compute Engine settings</h2><p>If the instance is going to be a regular Web server (for example serving URL <code>blog.mysitename.com</code>), it needs a <a href="https://cloud.google.com/compute/docs/ip-addresses">static external IP</a> (not ephemeral). Also, during Compute Engine instance setup, the firewall needs to be configured to pass HTTP and HTTPS.</p><h2>MySQL</h2><p><a href="https://ghost.org/docs/install/ubuntu/">The instructions</a> tell us to install MySQL:</p><pre><code>sudo apt-get install mysql-server
</code></pre><p>But after installing MySQL, running <code>ghost install</code> and providing an empty password didn't work. I had to set a MySQL root password using mostly <a href="https://phoenixnap.com/kb/how-to-reset-mysql-root-password-windows-linux">these instructions</a>, and then paste the password when running the setup script.</p><h2>Setting up SSL</h2><p>Initially I set up Ghost without SSL (during <code>ghost install</code>). Then, after adding instance IP to DNS settings in our DNS provider page, I had to re-run <code>ghost setup ssl</code> <strong>several times</strong> to make it work without error.</p><h2>Install library to communicate with Google Cloud Storage</h2><p>Because we decided to use Google Cloud Storage for storing attached files, I needed to install a plugin for communication with GCS.</p><p>As of writing that (April 2023), a library that works is <code>@danmasta/ghost-gcs-adapter</code>, and it needs to be installed using <strong>exactly</strong> the commands from its documentation, which is <a href="https://github.com/danmasta/ghost-gcs-adapter#installation">here</a>, not as a part of a Dockerfile, but directly in the shell:</p><pre><code>export GHOST_INSTALL=/var/www/mysitename-ghost
mkdir -p /tmp/gcs ${GHOST_INSTALL}/current/core/server/adapters/storage/gcs
curl -s "$(npm view @danmasta/ghost-gcs-adapter dist.tarball)" | tar xz -C /tmp/gcs
npm install --prefix /tmp/gcs/package --silent --only=production --no-optional --no-progress
mv /tmp/gcs/package/* ${GHOST_INSTALL}/current/core/server/adapters/storage/gcs
</code></pre><p>For authentication with Google Cloud Storage, upload the key file in JSON format to <code>/var/www/mysitename-ghost</code>. Then, in the Ghost configuration file, specify connection parameters:</p><pre><code>  "storage": {
    "active": "gcs",
    "gcs": {
      "storageOptions": {
        "keyFilename": "mysitename-key-13245314252345.json"
      },
      "bucket": "mysitename-bucket"
    }
  }
</code></pre><h2>RAM</h2><p>Running <code>ghost doctor</code> says that the instance doesn't have enough RAM, even though everything is installed on a VM with 1 GB of RAM, <a href="https://ghost.org/docs/install/ubuntu/#prerequisites">which is enough according to Ghost documentation</a>. I don't know if it's going to cause problems.</p><a href="/">Go back to home page</a></article><link href="/styles/prism-atom-dark.css" rel="stylesheet"><footer><div class="footer-content"><a href="https://www.radcode.co/">Do you need an app?</a></div></footer></body></html>